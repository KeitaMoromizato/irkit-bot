module.exports = (robot) ->

  request = require 'request'
  URL = "https://api.getirkit.com/1/messages"

  robot.hear /^irkit help/i, (msg) ->
    text = ""
    text += "IRKitのヘルプです\n"
    text += "-------------------------------\n"
    text += "screen down - スクリーンを下げる\n"
    text += "screen up - スクリーンを上げる\n"
    text += "projector on - プロジェクターをONにする\n"
    text += "projector off - プロジェクターをOFFにする\n"
    msg.send text

  robot.hear /^screen down/i, (msg) ->
    sendMessage [17421,8755,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,1111,3341,1111,3341,1111,3341,1111,3341,1111,3341,1111,3341,1111,3341,1111,3341,1111,1111,1111,1111,1111,1111,1111,1111,1111,3341,1111,1111,1111,1111,1111,1111,1111,3341,1111,3341,1111,3341,1111,3341,1111,1111,1111,3341,1111,3341,1111,3341,1111,65535,0,14172,17421,4400,1150], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  robot.hear /^screen up/i, (msg) ->
    sendMessage [17421,9061,873,1366,873,1366,873,1366,1073,1190,935,1150,1037,1190,1037,1190,1037,1190,1037,3579,873,3579,873,3579,873,3579,873,3579,873,3579,1002,3579,1002,3579,873,3458,1037,1319,935,1319,843,1319,968,3458,968,1319,873,1319,873,1319,873,1190,968,3579,968,3579,968,3579,968,1319,873,3579,815,3579,904,3579,904,65535,0,14172,17421,4878,787,65535,0,65535,0,60108,17421,4713,843,65535,0,65535,0,60108,17421,4713,815], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  robot.hear /^projector on/i, (msg) ->
    sendMessage [18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3228,1150,3228,1150,1150,1150,1150,1150,3228,1150,3228,1150,3228,1150,3228,1150,1150,1150,1150,1150,3228,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3228,1150,3228,1150,1150,1150,3228,1150,65535,0,26325,18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3228,1150,3228,1150,1150,1150,1150,1150,3228,1150,3228,1150,3228,1150,3228,1150,1150,1150,1150,1150,3228,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3228,1150,3228,1150,1150,1150,3228,1150], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  robot.hear /^projector off/i, (msg) ->
    sendMessage [18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,3341,1150,65535,0,26325,18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,3341,1150,65535,0,26325,18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,3341,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,3341,1150], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  robot.hear /^projector hdmi/i, (msg) ->
    sendMessage [18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,3341,1150,1150,1150,3341,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,3341,1150,65535,0,26325,18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,3341,1150,1150,1150,3341,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,3341,1150], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  robot.hear /^projector com/i, (msg) ->
    sendMessage [18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,1150,1150,1150,1150,3341,1150,3341,1150,3341,1150,3341,1150,3341,1150,1150,1150,3341,1150,65535,0,26325,18031,8755,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,3341,1150,1150,1150,1150,1150,3341,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,1150,3341,1150,1150,1150,1150,1150,3341,1150,3341,1150,3341,1150,3341,1150,3341,1150,1150,1150,3341,1150], (error) ->
      return msg.send `error ? "ERROR" + error : "SUCCESS"`

  sendMessage = (data, callback) ->
    message = format: "raw", freq:38, data: data
    params = clientkey: process.env.IRKIT_CLIENT_KEY, deviceid: process.env.IRKIT_DEVICE_ID, message: JSON.stringify(message)
    options = url: URL, form: params

    request.post options, (error, response, body) ->
      if error || response.statusCode != 200
        return callback error || body
      callback null
